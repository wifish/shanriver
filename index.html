<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SVG BG</title>
    <script type="text/javascript" src="resource/lib/d3.v3.js"></script>
    <style type="text/css">
        *{padding: 0; margin: 0;}
        body {background: #336666;}
    </style>
</head>

<body>

<div id="container"></div>

<script type="text/javascript">

    var config = {"nodenum":7};
    var color = d3.scale.category20();
    var data = [];

    var container = d3.select("#container");

    var svg = container.append("svg");
    var node ,link;          


    //生成数据     
    function generate_data(){
        var p ;
        for(var i=0 ;i<config.nodenum;i++){
            p = random_positin();
            data.push({"id":i,"cx":p[0],"cy":p[1]})
        }      
    }          

    //刷新数据
    function update_data(){
        var p ;

        if(data.length === 0 ) {return;}

        data.forEach(function(d){
            p = random_positin();
            d.cx = p[0];
            d.cy = p[1];
        });    

        //console.log(data);    
    }

    //绘图
    function draw(){
      
        node = svg.selectAll(".node")
              .data(data)
              .enter()
              .append("circle")
              .attr("class","node")
              .attr("cx",function(d,i){return d.cx;})
              .attr("cy",function(d,i){return d.cy;})              
              .attr("r",function(d,i){return Math.random() * 20 + 10})
              .attr("fill",function(d,i){return color(d.cx + d.cy);})
              .style({
                "stroke-width":7,
                "stroke":"#ffffff",
                "opacity":0.3})
              ;       
    }

    //
    function redraw(){
        
        set_size();    
        
        //更新数据
        update_data();

        //更新节点
        node.data(data)
            .transition()
            .duration(function(d,i){return 29999 })
            .delay(0)
            .attr("cx",function(d,i){return d.cx;})
            .attr("cy",function(d,i){return d.cy;})
            .attr("r",function(d,i){return Math.random() * 20 + 10})
            .attr("fill",function(d,i){return color(d.cx + d.cy);})
            ;         
                                     
    }



    //返回边框上任意坐标
    function random_positin(){

        var x = Math.random() * (config.width - 0) + 0 ;
        var y = Math.random() * (config.height - 0) + 0;
        var i = Math.floor(Math.random() * 3) ;        

        var base_array = [[x,0],[x,config.height],[0,y],[config.width,y]];

        return  base_array[i];
    }


    //动画
    function animation(){

        //setTimeout(redraw,1000);        
        //redraw();

        //每个30秒执行一次
        redraw()
        window.setInterval("redraw()",30000);
    }

    //
    function set_size(){
      config.width = window.innerWidth * 0.986;
      config.height = window.innerHeight * 0.997;

      svg.attr("width",config.width)
         .attr("height",config.height);
    }



    //初始化
    function init(){
      
      set_size();


      //预处理数据
      generate_data();

      //初始化模块

      //绘图
      draw();

      animation();
    }        

    window.onload = function(){init();}   
    window.onresize = function(){redraw();}

</script>
</body>
</html>